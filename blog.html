<!doctype html>
<html>
  <title>Blog</title>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <script>
    function defer(func, str, args) {
      if (!eval(str)) {
        setTimeout(function() {defer(func, str, args)}, 4);
      } else func(args);
    }
    
    var done = false;
    $.get('details', function(data) {
      var post = JSON.parse(data);
      $('body').html('<hr><article><h1>'+post.title+'</h1><main><script async>var content = "";$.get("'+post.url+'",function(data){content = data;});defer(function(args){console.log(args[0]);}, "content", [this])</sc'+'ript></main></article>'+$('body').html());
      done = true;
    });
    
    defer(
      function() {
        $('body').html($('body').html()+'<hr>');
        var articles = $('article');
        for (var i=0; i<articles.length; i++) {
          
          $.get(articles.eq(i).attr('url'), function(data) {
            console.log(articles.eq(i).attr('url'));
            console.log(data);
            articles.eq(i).html(data);
          });
        }
      },
    'done');
  </script>
  <body>
  </body>
</html>
